<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welcome to XIV Challenge run generator</title>
    <style>
        body {
            background-color: #0c0c0c;
            color: #ffffff;
            font-family: "Final Fantasy XIV Font", sans-serif;
            text-align: center;
            margin: 0;
            padding: 0;
        }
        .title {
            padding: 20px;
            font-size: 36px;
        }
        .form-container {
            margin-top: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .form-group {
            margin: 10px;
            display: flex;
            align-items: center;
        }
        .form-group2 {
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .form-group label {
            margin-right: 10px;
        }
        .text-field {
            margin: 10px;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        .info-icon {
            cursor: pointer;
            position: relative;
            background-color: #0073e6;
            color: #fff;
            width: 20px; /* Smaller circle */
            height: 20px; /* Smaller circle */
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-left: 5px;
        }
        .info-icon::before {
            content: "i";
            font-weight: bold;  
        }
        .info-popup {
            display: none;
            position: absolute;
            background-color: rgba(255, 255, 255, 1.0);
            color: #000000;
            padding: 5px;
            border-radius: 5px;
            bottom: 25px;
            left: 50%;
            transform: translateX(-50%);
            white-space: nowrap;
        }
        .info-icon:hover .info-popup {
            display: block;
        }
        /* Arrange 8 text fields in a 2x4 grid pattern */
        .text-field-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            grid-template-rows: repeat(4, 1fr);
            grid-gap: 10px;
        }

        /* Style for the Generate button and result text field */
        .generate-button {
            margin: 20px 20px;
            padding: 10px 20px;
            background-color: #0073e6;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .result-text {
            width: 100%;
            max-width: 800px;
            height: 100px; /* Increase the height */
            background-color: #fff; /* White background color */
            color: #333; /* Dark text color */
            border: none;
            border-radius: 5px;
            overflow: auto; /* Add scrolling if content exceeds the height */
            resize: none;
        }
    </style>
</head>
<body>
    <div class="title">Welcome to XIV Challenge run generator</div>
    <div class="form-container">
        <form>
            <div class="form-group">
                <label for="constrains">Choose the number of constrain(s):</label>
                <select id="constrains" name="constrains" tabindex="1">
                    <option value="1">1</option>
                    <option value="2" selected>2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                </select>
                <span class="info-icon">
                    <span class="info-popup">Depending on the constrain(s) selected you may need to enable the option "Unrestricted party".<br>If you do so, also enable the "Level sync" option.</span>
                </span>
            </div>
            <div class="form-group" >
                <label for="partySize">Party size:</label>
                <input type="radio" id="partySize4" name="partySize" value="4" tabindex="2">
                <label for="partySize4">4</label>
                <input type="radio" id="partySize8" name="partySize" value="8" tabindex="2">
                <label for="partySize8">8</label>
            </div>
            <div class="form-group">
                <label for="includeHardContent">Include hard content:</label>
                <input type="checkbox" id="includeHardContent" name="includeHardContent" tabindex="3">
                <span class="info-icon">
                    <span class="info-popup">Will include extreme and savage content</span>
                </span>
            </div>
            <div class="form-group">
                <label for="playerNames">Player names:</label>
                <span class="info-icon">
                    <span class="info-popup">If given, the generator will tell you who needs to play what. <br>Missing name(s) will be replaced by generic one.</span>
                </span>
            </div>
            <!-- Arrange 8 text fields in a 2x4 grid pattern -->
            <div class="text-field-container">
                <div class="text-field">
                    <input type="text" id="textField1" name="textField1" tabindex="4">
                </div>
                <div class="text-field">
                    <input type="text" id="textField2" name="textField2" tabindex="8">
                </div>
                <div class="text-field">
                    <input type="text" id="textField3" name="textField3" tabindex="5">
                </div>
                <div class="text-field">
                    <input type="text" id="textField4" name="textField4" tabindex="9">
                </div>
                <div class="text-field">
                    <input type="text" id="textField5" name="textField5" tabindex="6">
                </div>
                <div class="text-field">
                    <input type="text" id="textField6" name="textField6" tabindex="10">
                </div>
                <div class="text-field">
                    <input type="text" id="textField7" name="textField7" tabindex="7">
                </div>
                <div class="text-field">
                    <input type="text" id="textField8" name="textField8" tabindex="11">
                </div>
            </div>
            <div class="form-group2">
                <button type='button' class="generate-button" id="generateButton" tabindex="12">Generate</button>
                <button type='button' class="generate-button" id="ResetButton" tabindex="99">Reset</button>
            </div>
            <textArea type="text" class="result-text" id ="result" tabindex="99" readonly>This text area is not inteded to be read, just to validate the generation of the challenge. Copy paste it to discord to discover the challenge at the same time than your mates</textArea>
            <div class="form-group2">
                <button type='button' class="generate-button" id="copyButton" tabindex="13">Copy to Clipboard</button>
                <span class="info-icon">
                    <span class="info-popup">This is discord ready. Just click the button and paste in discord.</span>
                </span>
            </div>
        </form>
    </div>
    <!-- JavaScript for generating content -->
    <script  type="text/javascript" src="challenger_bot.js"></script>
    <script  type="text/javascript">
        const constrains = document.getElementById("constrains");
        const hard = document.getElementById("includeHardContent");
        const partySize4 = document.getElementById("partySize4");
        const partySize8 = document.getElementById("partySize8");
        const textFields = document.querySelectorAll(".text-field input");
        const p1 = document.getElementById("textField1");
        const p2 = document.getElementById("textField3");
        const p3 = document.getElementById("textField5");
        const p4 = document.getElementById("textField7");
        const p5 = document.getElementById("textField2");
        const p6 = document.getElementById("textField4");
        const p7 = document.getElementById("textField6");
        const p8 = document.getElementById("textField8");
        const generateButton = document.getElementById("generateButton");
        const resetButton = document.getElementById("ResetButton");
        const resultText = document.getElementById("result");
        const copyButton = document.getElementById("copyButton");
        const fieldTabIndex = ["4", "8", "5", "9", "6", "10", "7", "11"];

        // Initially, set the 2nd column text fields as readonly and grayed out
        // textFields.forEach((textField, index) => {
        //     if (index % 2 !== 0) {
        //         textField.setAttribute("readonly", "readonly");
        //         textField.style.backgroundColor = "#555"; // Dark gray background color
        //     }
        // });

        // Add event listeners to radio buttons to enable/disable text fields
        partySize4.addEventListener("change", () => {
            textFields.forEach((textField, index) => {
                if (index % 2 === 0) {
                    textField.removeAttribute("readonly");
                    textField.setAttribute("tabindex", fieldTabIndex[index]);
                    textField.style.backgroundColor = ""; // Reset background color
                } else {
                    textField.setAttribute("readonly", "readonly");
                    textField.setAttribute("tabindex", "99");
                    textField.style.backgroundColor = "#555"; // Dark gray background color
                }
            });
        });

        partySize8.addEventListener("change", () => {
            textFields.forEach((textField, index) => {
                textField.removeAttribute("readonly");
                textField.setAttribute("tabindex", fieldTabIndex[index]);
                textField.style.backgroundColor = ""; // Reset background color
            });
        });

        copyButton.addEventListener("click", () => {
            // Select the text inside the result text field
            resultText.select();
            resultText.setSelectionRange(0, 99999); // For mobile devices

            // Copy the selected text to the clipboard
            document.execCommand("copy");

            // Deselect the text
            resultText.setSelectionRange(0, 0);
        });

        document.addEventListener("DOMContentLoaded", onDOMReady);

        function saveContent() {
            textFields.forEach((textField) => {
                localStorage.setItem(textField.name, textField.value);
            });

            localStorage.setItem(constrains.name, constrains.value);
            localStorage.setItem('ps_local4', partySize4.checked);
            localStorage.setItem('ps_local8', partySize8.checked);
            localStorage.setItem(hard.name, hard.checked);

            console.log(localStorage.getItem('ps_local4'));
            console.log(localStorage.getItem('ps_local8'));
        }

        function onDOMReady() {
            setDefault();
            if (localStorage.getItem(constrains.name) !== null)
            {
                constrains.value = localStorage.getItem(constrains.name);
            }

            if (localStorage.getItem('ps_local4') !== null)
            {
                partySize4.checked = localStorage.getItem('ps_local4').toLowerCase() === "true";
            }

            if (localStorage.getItem('ps_local8') !== null)
            {
                partySize8.checked = localStorage.getItem('ps_local8').toLowerCase() === "true";
            }

            if (localStorage.getItem(hard.name) !== null)
            {
                hard.checked = localStorage.getItem(hard.name).toLowerCase() === "true";
            }

            textFields.forEach((textField, index) => {
                if (localStorage.getItem(textField.name) !== null)
                {
                    textField.value = localStorage.getItem(textField.name);
                }
                if(partySize4.checked) {
                    if (index % 2 === 0) {
                        textField.removeAttribute("readonly");
                        textField.setAttribute("tabindex", fieldTabIndex[index]);
                        textField.style.backgroundColor = ""; // Reset background color
                    } else {
                        textField.setAttribute("readonly", "readonly");
                        textField.setAttribute("tabindex", "99");
                        textField.style.backgroundColor = "#555"; // Dark gray background color
                    }
                }
                else
                {
                    textField.removeAttribute("readonly");
                    textField.setAttribute("tabindex", fieldTabIndex[index]);
                    textField.style.backgroundColor = ""; // Reset background color
                }
            });

        }

        function setDefault() {
            textFields.forEach((textField, index) => {
                textField.value = "";
                if (index % 2 !== 0) {
                    textField.setAttribute("readonly", "readonly");
                    textField.setAttribute("tabindex", "99");
                    textField.style.backgroundColor = "#555"; // Dark gray background color
                }
            });
            constrains.value = '2';
            partySize4.checked = true;
            partySize8.checked = false;
            hard.checked = false;
        }

        function onPageClose(event) {
            saveContent();
        }

        resetButton.addEventListener("click", () => {
            setDefault();

            textFields.forEach((textField) => {
                localStorage.removeItem(textField.name);
            });

            localStorage.removeItem(constrains.name);
            localStorage.removeItem('ps_local4');
            localStorage.removeItem('ps_local8');
            localStorage.removeItem(hard.name);
        });

        generateButton.addEventListener("click", async () => {
            const playerNames = [p1.value, p2.value, p3.value, p4.value, p5.value, p6.value, p7.value, p8.value];

            const res = await generateChallenge(constrains.value, partySize4.checked, partySize8.checked, playerNames, hard.checked);
            resultText.value = res;
            saveContent();
        });
    </script>
</body>
</html>
